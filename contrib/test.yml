settings:
  extract_dir: ext

preflight:
  - task: Enable Docker repo (Debian|Ubuntu)
    when: is-debian is-ubuntu
    unless:
      stat: /etc/apt/sources.list.d/docker.list
    steps:
      - name: shell
        shell: bash
        cmd: |
          set -euEo pipefail
          mkdir -p /etc/apt/keyrings
          curl -fsSL https://download.docker.com/linux/ubuntu/gpg | gpg --dearmor -o /etc/apt/keyrings/docker.gpg
          chmod a+r /etc/apt/keyrings/docker.gpg
          echo "deb [arch="$(dpkg --print-architecture)" signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu "$(. /etc/os-release && echo "$VERSION_CODENAME")" stable" > /etc/apt/sources.list.d/docker.list
          apt update

packages:
  debian|ubuntu:
    - docker-buildx-plugin
    - docker-ce
    - docker-ce-cli
    - docker-compose-plugin
